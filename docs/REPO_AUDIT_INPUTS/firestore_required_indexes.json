{
  "version": 1,
  "description": "Firestore composite indexes required to keep admin read paths fail-closed without runtime missing-index errors.",
  "indexes": [
    {
      "id": "audit_logs_action_createdAt_desc",
      "collectionGroup": "audit_logs",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "action",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/auditLogsRepo.js",
          "line": 36
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/auditLogsRepo.js",
          "line": 38
        }
      ],
      "observedBy": {
        "kind": "route_error_missing_index",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.product_readiness.view"
      }
    },
    {
      "id": "audit_logs_action_templateKey_createdAt_desc",
      "collectionGroup": "audit_logs",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "action",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "templateKey",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/auditLogsRepo.js",
          "line": 36
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/auditLogsRepo.js",
          "line": 37
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/auditLogsRepo.js",
          "line": 38
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.os_alerts_summary"
      }
    },
    {
      "id": "link_registry_lastHealth_state_createdAt_desc",
      "collectionGroup": "link_registry",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "lastHealth.state",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/linkRegistryRepo.js",
          "line": 40
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/linkRegistryRepo.js",
          "line": 41
        }
      ],
      "observedBy": {
        "kind": "route_error_missing_index",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.os_alerts_summary"
      }
    },
    {
      "id": "city_packs_language_status_updatedAt_desc",
      "collectionGroup": "city_packs",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "language",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "updatedAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/cityPacksRepo.js",
          "line": 328
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/cityPacksRepo.js",
          "line": 332
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/cityPacksRepo.js",
          "line": 333
        }
      ],
      "observedBy": {
        "kind": "route_error_missing_index",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.city_packs"
      }
    },
    {
      "id": "notifications_status_createdAt_desc",
      "collectionGroup": "notifications",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/notificationsRepo.js",
          "line": 32
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/notificationsRepo.js",
          "line": 35
        }
      ],
      "observedBy": {
        "kind": "route_error_missing_index",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.os_alerts_summary"
      }
    },
    {
      "id": "send_retry_queue_status_createdAt_desc",
      "collectionGroup": "send_retry_queue",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/sendRetryQueueRepo.js",
          "line": 45
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/sendRetryQueueRepo.js",
          "line": 46
        }
      ],
      "observedBy": {
        "kind": "route_error_missing_index",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.os_alerts_summary"
      }
    },
    {
      "id": "decision_logs_audit_notificationId_decidedAt_desc",
      "collectionGroup": "decision_logs",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "audit.notificationId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "decidedAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/decisionLogsRepo.js",
          "line": 62
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/decisionLogsRepo.js",
          "line": 63
        }
      ],
      "observedBy": {
        "kind": "route_error_missing_index",
        "dateUtc": "2026-02-23",
        "service": "member",
        "route": "admin.os_alerts_summary"
      }
    },
    {
      "id": "journey_todo_items_status_nextReminderAt_asc",
      "collectionGroup": "journey_todo_items",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "nextReminderAt",
          "order": "ASCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 209
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 210
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 211
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-24",
        "service": "member",
        "route": "internal.journey_todo_reminder_job"
      }
    },
    {
      "id": "journey_todo_items_lineUserId_updatedAt_desc",
      "collectionGroup": "journey_todo_items",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "lineUserId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "updatedAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 199
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 202
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-24",
        "service": "member",
        "route": "admin.os_user_billing_detail"
      }
    },
    {
      "id": "journey_todo_items_lineUserId_status_updatedAt_desc",
      "collectionGroup": "journey_todo_items",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "lineUserId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "updatedAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 198
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 200
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyTodoItemsRepo.js",
          "line": 202
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-24",
        "service": "member",
        "route": "line.todo_list"
      }
    },
    {
      "id": "task_nodes_lineUserId_updatedAt_desc",
      "collectionGroup": "task_nodes",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "lineUserId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "updatedAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/taskNodesRepo.js",
          "line": 188
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/taskNodesRepo.js",
          "line": 189
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-25",
        "service": "member",
        "route": "line.task_graph_summary"
      }
    },
    {
      "id": "journey_branch_queue_status_nextAttemptAt_asc",
      "collectionGroup": "journey_branch_queue",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "nextAttemptAt",
          "order": "ASCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 177
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 180
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-25",
        "service": "member",
        "route": "internal.journey_branch_dispatch_job"
      }
    },
    {
      "id": "journey_branch_queue_status_createdAt_desc",
      "collectionGroup": "journey_branch_queue",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 165
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 167
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-25",
        "service": "member",
        "route": "admin.journey_graph_branch_queue_status"
      }
    },
    {
      "id": "journey_branch_queue_lineUserId_createdAt_desc",
      "collectionGroup": "journey_branch_queue",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "lineUserId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 166
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 167
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-25",
        "service": "member",
        "route": "admin.journey_graph_branch_queue_status"
      }
    },
    {
      "id": "journey_branch_queue_status_lineUserId_createdAt_desc",
      "collectionGroup": "journey_branch_queue",
      "queryScope": "COLLECTION",
      "fields": [
        {
          "fieldPath": "status",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "lineUserId",
          "order": "ASCENDING"
        },
        {
          "fieldPath": "createdAt",
          "order": "DESCENDING"
        }
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 165
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 166
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/journeyBranchQueueRepo.js",
          "line": 167
        }
      ],
      "observedBy": {
        "kind": "critical_contract_dependency",
        "dateUtc": "2026-02-25",
        "service": "member",
        "route": "admin.journey_graph_branch_queue_status"
      }
    }
  ],
  "criticalContracts": [
    {
      "contractId": "admin_product_readiness",
      "routeOrUsecase": "GET /api/admin/product-readiness",
      "requiredIndexIds": [
        "audit_logs_action_createdAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1093
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/productReadiness.js",
          "line": 217
        }
      ]
    },
    {
      "contractId": "admin_read_path_fallback_summary",
      "routeOrUsecase": "GET /api/admin/read-path-fallback-summary",
      "requiredIndexIds": [
        "audit_logs_action_createdAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1087
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/readPathFallbackSummary.js",
          "line": 121
        }
      ]
    },
    {
      "contractId": "admin_retention_runs",
      "routeOrUsecase": "GET /api/admin/retention-runs",
      "requiredIndexIds": [
        "audit_logs_action_createdAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1069
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/retentionRuns.js",
          "line": 79
        }
      ]
    },
    {
      "contractId": "admin_struct_drift_backfill_runs",
      "routeOrUsecase": "GET /api/admin/struct-drift/backfill-runs",
      "requiredIndexIds": [
        "audit_logs_action_createdAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 708
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/structDriftBackfill.js",
          "line": 22
        }
      ]
    },
    {
      "contractId": "admin_os_alerts_summary",
      "routeOrUsecase": "GET /api/admin/os/alerts/summary",
      "requiredIndexIds": [
        "link_registry_lastHealth_state_createdAt_desc",
        "notifications_status_createdAt_desc",
        "send_retry_queue_status_createdAt_desc",
        "decision_logs_audit_notificationId_decidedAt_desc",
        "audit_logs_action_templateKey_createdAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1260
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/osAlerts.js",
          "line": 101
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/usecases/admin/getNotificationReadModel.js",
          "line": 159
        }
      ]
    },
    {
      "contractId": "admin_city_packs_list",
      "routeOrUsecase": "GET /api/admin/city-packs",
      "requiredIndexIds": [
        "city_packs_language_status_updatedAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 792
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/cityPacks.js",
          "line": 160
        }
      ]
    },
    {
      "contractId": "internal_journey_todo_reminder_job",
      "routeOrUsecase": "POST /internal/jobs/journey-todo-reminder",
      "requiredIndexIds": [
        "journey_todo_items_status_nextReminderAt_asc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1258
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/usecases/journey/runJourneyTodoReminderJob.js",
          "line": 113
        }
      ]
    },
    {
      "contractId": "admin_os_user_billing_detail_journey",
      "routeOrUsecase": "GET /api/admin/os/user-billing-detail",
      "requiredIndexIds": [
        "journey_todo_items_lineUserId_updatedAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1509
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/osUserBillingDetail.js",
          "line": 39
        }
      ]
    },
    {
      "contractId": "line_task_graph_summary",
      "routeOrUsecase": "POST /webhook/line (task graph summary for free/pro assistant)",
      "requiredIndexIds": [
        "task_nodes_lineUserId_updatedAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/webhookLine.js",
          "line": 208
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/repos/firestore/taskNodesRepo.js",
          "line": 186
        }
      ]
    },
    {
      "contractId": "internal_journey_branch_dispatch_job",
      "routeOrUsecase": "POST /internal/jobs/journey-branch-dispatch",
      "requiredIndexIds": [
        "journey_branch_queue_status_nextAttemptAt_asc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1303
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/usecases/journey/runJourneyBranchDispatchJob.js",
          "line": 65
        }
      ]
    },
    {
      "contractId": "admin_journey_graph_branch_queue_status",
      "routeOrUsecase": "GET /api/admin/os/journey-graph/branch-queue/status",
      "requiredIndexIds": [
        "journey_branch_queue_status_createdAt_desc",
        "journey_branch_queue_lineUserId_createdAt_desc",
        "journey_branch_queue_status_lineUserId_createdAt_desc"
      ],
      "sourceEvidence": [
        {
          "path": "/Users/parentyai.com/Projects/Member/src/index.js",
          "line": 1712
        },
        {
          "path": "/Users/parentyai.com/Projects/Member/src/routes/admin/journeyGraphBranchQueue.js",
          "line": 45
        }
      ]
    }
  ],
  "assumptions": [
    "Definitions are add-only; do not remove existing index contracts.",
    "Indexes are evaluated by collectionGroup + queryScope + ordered field tuple.",
    "Firestore synthetic __name__ ordering is ignored in diff because it is auto-appended by API responses."
  ]
}
